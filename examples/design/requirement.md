---

### 多安全产品共享数据湖 ER 模式设计需求表

| 类别            | 具体要求                                                                            | 期望效果                                   | 可参考的思路                                                                      |
| ------------- | ------------------------------------------------------------------------------- | -------------------------------------- | --------------------------------------------------------------------------- |
| **数据标准化**     | 统一字段命名、类型、时间戳格式（如UTC+0、ISO8601），参考 OCSF / ECS / STIX 规范                         | 不同安全产品日志可直接 JOIN 分析，减少字段映射成本           | 参考 **OCSF Core schema**，定义统一字段前缀（src\_ / dst\_ / user\_ / device\_），并制定字段字典 |
| **核心实体定义**    | 设计 User、Device、Session、Event、Alert、Policy、ThreatIndicator、Asset、Application 等实体 | 支撑跨场景的事件关联（如同一用户多源告警追踪）                | 按 MITRE ATT\&CK 模型抽象攻击链涉及的对象，保证实体涵盖身份、资产、威胁三类上下文                            |
| **SASE 优先建模** | 覆盖 CASB、ZTNA、SWG、SD-WAN 典型字段（身份、应用、策略、流量、会话状态）                                  | 快速关联云访问、零信任会话和流量分析，发现违规访问或威胁行为         | CASB + IAM：统一 user\_id；ZTNA + EDR：统一 device\_id；SWG + WAF：统一 URL、domain 维度  |
| **安全场景扩展**    | 将 EDR、SIEM、SOAR、WAF、DLP、NGFW、CWPP 等映射到通用实体                                      | 支持威胁全链路分析（网络-应用-终端-云-数据）               | 设计事实表 SecurityEventFact，按 event\_type 分类并关联维度表，适配不同产品                       |
| **事件生命周期**    | 记录事件从检测 → 关联分析 → 响应 → 关闭的全流程状态                                                  | 支持态势感知和 SOAR 自动化编排                     | 增加 `event_status` 字段（New / InProgress / Mitigated / Closed），并维护事件时间轴表       |
| **关联字段设计**    | 建立全局唯一ID（UUID）、统一资产ID、统一用户ID                                                    | 跨日志源唯一匹配实体，支持追溯                        | 使用哈希算法（user+domain）、资产CMDB ID、统一 UUID 生成规则                                  |
| **性能与分区策略**   | 支持按时间、事件类型、业务单元、地理区域分区                                                          | 提高 ClickHouse / StarRocks / Doris 查询性能 | 使用列式存储 + 分区 + 物化视图；冷热分层（近实时数据+归档数据）                                         |
| **威胁情报集成**    | 设计 IOC 维度表，支持 IP、域名、URL、文件哈希、CVE 等多类型指标                                         | 自动比对内外部威胁情报，提高检测准确度                    | 采用 STIX/TAXII 格式，建立 IOC\_Type、IOC\_Value、FirstSeen、LastSeen 等字段             |
| **上下文标签化**    | 在事实表中增加标签字段（攻击阶段、策略类型、业务关键性）                                                    | 在分析中快速筛选关键事件                           | 标签参考 MITRE ATT\&CK 战术阶段、CIS 控制框架标签                                          |
| **数据治理**      | 明确数据保留周期（热存储7-90天、冷存储1-3年）、脱敏策略、访问控制                                            | 合规性满足监管（GDPR、等保2.0）要求                  | ClickHouse Row Policy + Masking，字段级访问控制，数据生命周期管理表                           |
| **可扩展性**      | 新安全产品接入只需映射到现有实体及字段                                                             | 快速适配新技术场景（IoT安全、AI安全）                  | 模型采用可选字段、JSON 扩展列（ClickHouse Nested / Map 类型）                               |
| **可视化支持**     | 数据结构支持与 SIEM、BI 工具（Grafana、Superset、Kibana）对接                                   | 实现跨产品统一态势感知大屏                          | 建立统一的视图（View）封装复杂 JOIN，提供标准化查询接口                                            |
| **自动化响应**     | 结构支持 SOAR 平台回写响应动作                                                              | 实现检测-分析-处置闭环                           | 在事件事实表加入 `response_action`、`response_status`，SOAR 任务ID等字段                   |
| **元数据管理**     | 记录数据来源、解析规则版本、字段映射关系                                                            | 数据追溯与模型维护可控                            | 元数据表（source\_system、parser\_version、last\_update\_time）管理所有数据源              |

---

这个表格已经覆盖：

* **技术层**（字段、实体、分区、性能优化）
* **业务层**（事件生命周期、威胁情报、上下文标签）
* **合规与治理层**（保留周期、脱敏、访问控制）
* **SASE 优先场景**（CASB、ZTNA、SWG、SD-WAN）
* **扩展场景**（EDR、SIEM、WAF、DLP 等）

