### **StarRocks vs ClickHouse 性能对比测试总结**

#### **1. 硬件规格**
测试在StarRocks与ClickHouse使用同等资源配置下进行。
* **CPU**: 10核心
* **内存**: 平均使用量约 10-11G，SR峰值可达 22.7G，CK峰值可达 15.7G
* **数据量**: 导入2亿条数据进行测试

---

#### **2. 测试场景与核心指标对比**

| 测试场景 | 指标 | StarRocks (SR) 表现 | ClickHouse (CK) 表现 | 性能对比 (SR vs CK) |
| :--- | :--- | :--- | :--- | :--- |
| **场景一：热湖单读 (QPS)** | QPS | **175** | 76 | SR的QPS是CK的 **2.3倍** |
| | IO读取速度 | 峰值读取速度是CK的 **2.3倍** | - | SR 读取效率更高 |
| | IOPS | IOPS是CK的 **1/2** | - | SR 完成相同读取任务的IO次数更少 |
| **场景二：全文检索** | 查询性能 | **全面优于CK** | 性能随关键字增多而提升 | SR 性能更优且稳定 |
| | IOPS | IOPS是CK的 **1/5 至 1/7** | - | SR IO效率极高，磁盘IO次数显著减少 |
| **场景三：冷湖存储** | 性能 | **优于CK** | - | - |
| **场景四：读写混合** | 稳定性 | - | - | 在特定条件下，SR出现因内存限制导致查询失败的Bug (`Memory of query_pool exceed limit`) |

---

#### **3. 资源消耗对比**

| 资源类型 | 测试场景 | StarRocks (SR) | ClickHouse (CK) | 分析 |
| :--- | :--- | :--- | :--- | :--- |
| **CPU** | 单读 & 全文检索 | 约 10c (与CK基本持平) | 约 10c (与SR基本持平) | 两者CPU消耗无显著差异。 |
| **内存** | 单读（热湖） | 平均 11G, 峰值 **22.7G** | 平均 10G, 峰值 15.7G | SR内存占用（尤其是峰值）高于CK。 |
| | 全文检索 | - | 内存占用是SR的 **5倍** | 在全文检索场景，CK内存消耗远高于SR。 |
| **存储空间 (冷湖)** | 总占用 | **141.9G** | 105.2G | SR为提升性能，占用了更多的存储空间。 |
| | 数据大小 | 87G | 88G | 两者原始数据大小基本一致。 |
| | 索引大小 | **55G** | 17G | SR的索引大小是CK的 **3.2倍**。 |

---

#### **4. 结果分析**

1.  **磁盘IO效率**：在所有读密集型场景下，StarRocks的IOPS都显著低于ClickHouse，但读取吞吐量（速度）却更高或持平。这表明SR的磁盘读取效率更优，能够用更少的IO次数读取更多的数据。

2.  **性能与资源权衡**：
    * **冷湖场景**：SR通过牺牲约35%的存储空间（主要用于建立更大的索引，索引体积是CK的3倍多）来换取了比CK更高的查询性能。
    * **全文检索**：CK在该场景下消耗的内存是SR的5倍，说明SR的实现方式资源效率更高。

3.  **稳定性问题**：在读写混合场景下，当数据导入与查询并发进行时，SR暴露出一个因内存池超限而无法查询的Bug，这表明在极限压测下SR可能存在稳定性风险。

---

#### **5. 最终结论**

1.  **单读与全文检索场景**: 在同等硬件资源下，StarRocks（SR）的性能全面优于ClickHouse（CK）。特别是在热湖单读场景下，SR的QPS是CK的2.3倍。在全文检索场景下，SR在性能和资源利用率（特别是内存）方面优势明显。

2.  **核心优势来源**: SR的高性能主要得益于其高效的IO策略（用更少的IOPS实现高吞吐）和更优的索引策略。

3.  **资源与成本考量**: SR的性能优势并非没有代价。在冷湖场景中，它通过使用比CK多出近35%的存储空间（主要用于构建更大的索引）来获得性能提升。同时，在部分场景下其峰值内存消耗也更高。

4.  **短板与风险**: SR在混合读写高压测试中暴露出内存管理的稳定性问题，这是一个需要关注和修复的Bug。而CK在全文检索场景下，虽然总体性能不及SR，但其性能会随着检索关键字的增多而变好。